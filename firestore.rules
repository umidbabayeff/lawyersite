rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // User Profiles
    match /users/{userId} {
      // Anyone can read basic user info (needed for lawyer search results if we link)
      // But maybe restrict detailed client info?
      // Prompt says: Users - role, name, email. 
      // Lawyers need extensive read.
      allow read: if true; 
      
      // Users can write their own profile
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Lawyers
    match /lawyers/{lawyerId} {
      // Clients can read lawyers
      allow read: if true;
      
      // Lawyers can update their own profile
      // Check if the user is the lawyer
      allow write: if request.auth != null && request.auth.uid == lawyerId;
      
      // Admin might need write access too (to verify), but logic suggests 'admin' role check.
      // For MVP simple rule:
      allow write: if request.auth != null && (request.auth.uid == lawyerId || get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == "admin");
    }
  }
}
